<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üìÅ Folder & Billing App (All in One)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* üîπ Loader */
    #loader { position: fixed; inset: 0; background: linear-gradient(135deg, #1f1f1f, #3a3a3a);
      display: flex; justify-content: center; align-items: center; flex-direction: column; color: white;
      font-family: 'Segoe UI', sans-serif; z-index: 9999; transition: opacity 1s ease, visibility 1s;}
    #loader.fade-out { opacity: 0; visibility: hidden; }
    .spinner { border: 6px solid rgba(255,255,255,0.2); border-top: 6px solid #00ffcc;
      border-radius: 50%; width: 80px; height: 80px; display: flex; justify-content: center; align-items: center;
      animation: spin 1s linear infinite; margin-bottom: 15px; position: relative; }
    .spinner-text { position: absolute; font-size: 30px; font-weight: bold; color: white; }
    @keyframes spin { 0% {transform: rotate(0deg);} 100% {transform: rotate(360deg);} }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0; padding: 20px;
      background: linear-gradient(to bottom right, #121212, #232323);
      color: #fff; min-height: 100vh;
      display: flex; flex-direction: column;
    }

    .app-header {
      text-align: center; font-size: 28px; font-weight: 600;
      padding: 15px;
      background: linear-gradient(135deg, #4a90e2, #8e44ad);
      border-radius: 12px; margin-bottom: 20px;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
    }

    #container { display: flex; gap: 20px; flex-wrap: wrap; }
    #mainContent { flex: 2; min-width: 280px; }

    button {
      padding: 12px 20px;
      background: linear-gradient(90deg, #007bff, #00aaff);
      color: white; border: none; border-radius: 8px;
      cursor: pointer; margin-bottom: 15px; width: 100%;
      font-weight: 500; transition: all 0.3s ease;
    }
    button:hover { transform: scale(1.03); }

    .folder {
      padding: 12px 15px; background: rgba(76,175,80,0.85);
      border-radius: 8px; margin-bottom: 10px; cursor: pointer;
      text-align: center; font-weight: 500;
    }

    #billingPage {
      display: none; background: linear-gradient(to right, #283E51, #485563);
      color: white; padding: 20px; border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    .product-row {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 12px; background: rgba(255,255,255,0.06);
      padding: 10px; border-radius: 8px; flex-wrap: wrap; gap: 5px;
    }

    input {
      padding: 10px; border: none; border-radius: 6px;
      outline: none; font-size: 15px; margin-bottom: 5px;
    }
    input[type="text"] { flex: 1 1 60%; }
    input[type="number"] { flex: 1 1 30%; text-align: right; }
    input[type="tel"] { flex: 1 1 60%; margin-right: 5px; }

    #total, #remaining {
      text-align: right; font-size: 18px; font-weight: bold; margin-top: 10px;
      padding: 8px; border-radius: 6px;
    }
    #total { background: rgba(0,0,0,0.2); }
    #remaining.red { background: rgba(255,0,0,0.12); color: #ff6b6b; }
    #remaining.green { background: rgba(0,255,100,0.08); color: #00ff7f; }

    #remaining { transition: box-shadow 0.25s ease; }
    #remaining.flash { box-shadow: 0 0 8px rgba(255,255,255,0.15); transform: scale(1.01); }

    #backBtn { background: #6c757d; }

    #videoSection { text-align: center; margin-top: auto; padding: 15px; }
    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8);
      justify-content: center; align-items: center; }
    .modal-content { position: relative; background: #000; border-radius: 10px; width: 90%; max-width: 600px; overflow: hidden; }
    .close { position: absolute; top: 5px; right: 10px; color: white; font-size: 24px; cursor: pointer; }
    video { width: 100%; height: auto; border: none; }

    @media (max-width: 500px) {
      .app-header { font-size: 22px; }
      .product-row { flex-direction: column; align-items: stretch; }
      input[type="text"], input[type="number"], input[type="tel"] { width: 100%; }
      button { font-size: 14px; padding: 10px; }
    }
  </style>
</head>
<body>

  <div id="loader">
    <div class="spinner"><div class="spinner-text">C</div></div>
    <h2>Loading Folder & Billing App...</h2>
  </div>

  <div class="app-header">Folder & Billing App</div>

  <div id="folderPage">
    <div id="container">
      <div id="mainContent">
        <button onclick="createNewFolder()">+ New Folder</button>
        <div id="folders"></div>
      </div>
    </div>
  </div>

  <div id="billingPage">
    <button id="backBtn" onclick="showFolderPage()">‚¨Ö Back</button>
    <h1 id="folderName"></h1>
    <div id="dateTime"></div>

    <div id="productsContainer"></div>

    <button onclick="addProductLine()">+ New Line</button>
    <button onclick="saveFolder()">üíæ Save Folder</button>
    <button onclick="deleteFolder()">üóë Delete Folder</button>

    <div style="margin-top: 15px; display: flex; flex-wrap: wrap; gap: 5px;">
      <input type="tel" id="customerPhone" placeholder="Customer Phone Number">
      <button onclick="makeCall()">üìû Call</button>
      <button onclick="sendSMS()">üí¨ Send Message</button>
    </div>

    <div id="total">Total: ‚Çπ0</div>

    <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap; margin-top: 10px;">
      <input type="number" id="givenMoney" placeholder="Enter Given Money ‚Çπ" style="flex: 1;">
      <button id="enterBtn" onclick="updateBalance(true)" style="flex-shrink: 0; background: #28a745;">Enter</button>
    </div>
    <div id="remaining">Remaining: ‚Çπ0</div>
  </div>

  <div id="videoSection">
    <button onclick="openVideo()">üì∫ Watch Video ‚Äì How to Use</button>
  </div>

  <div id="videoModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeVideo()">&times;</span>
      <video id="tutorialVideo" controls>
        <source src="fbe604dd-c1d4-412e-990e-297266af5b6b.mp4" type="video/mp4">
        Your browser does not support video playback.
      </video>
    </div>
  </div>

  <script>
    // Loader
    window.addEventListener("load", () => {
      const loader = document.getElementById("loader");
      setTimeout(() => loader.classList.add("fade-out"), 2000);
    });

    let currentFolder = null, products = [], total = 0;

    function toNumber(val){ return isNaN(val) || val=="" ? 0 : Number(val); }
    function formatCurrency(num){ return Number(num).toLocaleString('en-IN'); }

    window.onload = function(){
      const savedFolders = JSON.parse(localStorage.getItem("folders")) || [];
      savedFolders.forEach(folder => displayFolder(folder.name));
    };

    function createNewFolder(){
      const folderName = prompt("Enter Folder Name:");
      if(!folderName) return;
      let savedFolders = JSON.parse(localStorage.getItem("folders")) || [];
      if(savedFolders.some(f => f.name === folderName)) return alert("Folder already exists!");
      savedFolders.push({ name: folderName, products: [], total: 0, phone: "", given: 0 });
      localStorage.setItem("folders", JSON.stringify(savedFolders));
      displayFolder(folderName);
    }

    function displayFolder(name){
      const folderDiv = document.createElement("div");
      folderDiv.className = "folder";
      folderDiv.innerText = name;
      folderDiv.onclick = () => openFolderPage(name);
      document.getElementById("folders").appendChild(folderDiv);
    }

    function openFolderPage(name){
      currentFolder = name;
      document.getElementById("folderPage").style.display="none";
      document.getElementById("billingPage").style.display="block";
      document.getElementById("folderName").textContent = "üìÇ " + name;
      document.getElementById("dateTime").textContent = "üïí " + new Date().toLocaleString();

      let savedFolders = JSON.parse(localStorage.getItem("folders")) || [];
      const folder = savedFolders.find(f => f.name === name);
      products = folder?.products || [];

      const container = document.getElementById("productsContainer");
      container.innerHTML = "";
      if(products.length === 0) addProductLine();
      else products.forEach(p => addProductLine(p.name, p.price));

      document.getElementById("customerPhone").value = folder?.phone || "";
      updateTotal();
      updateBalance();
    }

    function addProductLine(name = "", price = ""){
      const container = document.getElementById("productsContainer");
      const row = document.createElement("div");
      row.className = "product-row";

      const nameInput = document.createElement("input");
      nameInput.type = "text"; nameInput.placeholder = "Enter product name"; nameInput.value = name;

      const priceInput = document.createElement("input");
      priceInput.type = "number"; priceInput.placeholder = "Price ‚Çπ"; priceInput.value = price;
      priceInput.addEventListener("input", () => updateTotal(true));

      row.appendChild(nameInput);
      row.appendChild(priceInput);
      container.appendChild(row);
      updateTotal(true);
    }

    function updateTotal(autoSave=false){
      const prices = document.querySelectorAll('#productsContainer input[type="number"]');
      total = 0; prices.forEach(p => total += toNumber(p.value));
      document.getElementById("total").textContent = "Total: ‚Çπ" + formatCurrency(total);
      if(autoSave) saveFolderSilently();
    }

    // ‚úÖ Fixed function to subtract permanently from total
    function updateBalance(autoSave=false){
      const givenInput = document.getElementById("givenMoney");
      const given = toNumber(givenInput.value);
      const remElem = document.getElementById("remaining");

      // subtract permanently
      total -= given;
      if(total < 0) total = 0;

      document.getElementById("total").textContent = "Total: ‚Çπ" + formatCurrency(total);

      if(total > 0){
        remElem.textContent = "Remaining: ‚Çπ" + formatCurrency(total);
        remElem.className = "red";
      }else{
        remElem.textContent = "‚úÖ Fully Paid!";
        remElem.className = "green";
      }

      remElem.classList.add("flash");
      setTimeout(()=>remElem.classList.remove("flash"), 250);
      givenInput.value = "";
      if(autoSave) saveFolderSilently();
    }

    function saveFolderSilently(){
      const rows = document.querySelectorAll('.product-row');
      products = Array.from(rows).map(r=>({
        name: r.querySelector('input[type="text"]').value,
        price: toNumber(r.querySelector('input[type="number"]').value)
      }));
      const phone = document.getElementById("customerPhone").value;
      let savedFolders = JSON.parse(localStorage.getItem("folders")) || [];
      const index = savedFolders.findIndex(f=>f.name===currentFolder);
      if(index>-1){ savedFolders[index]={...savedFolders[index],products,total,phone}; }
      localStorage.setItem("folders", JSON.stringify(savedFolders));
    }

    function saveFolder(){ saveFolderSilently(); alert("‚úÖ Folder saved successfully!"); }
    function deleteFolder(){
      if(confirm("Are you sure you want to delete this folder?")){
        let savedFolders = JSON.parse(localStorage.getItem("folders")) || [];
        savedFolders = savedFolders.filter(f=>f.name!==currentFolder);
        localStorage.setItem("folders", JSON.stringify(savedFolders));
        alert("üóë Folder deleted successfully!"); showFolderPage();
      }
    }

    function showFolderPage(){ document.getElementById("billingPage").style.display="none"; document.getElementById("folderPage").style.display="block"; }
    function makeCall(){ const phone=document.getElementById("customerPhone").value; if(!phone)return alert("Please enter a phone number."); window.location.href=`tel:${phone}`; }
    function sendSMS(){
      const phone=document.getElementById("customerPhone").value;
      if(!phone)return alert("Please enter a phone number first.");
      const remaining = total;
      let message = remaining > 0 
        ? `You have to pay ‚Çπ${formatCurrency(remaining)} ‚Äî Kudachi mestri 8050671347`
        : `‚úÖ Fully Paid! ‚Äî Kudachi mestri 8050671347`;
      window.location.href=`sms:${phone}?body=${encodeURIComponent(message)}`;
    }

    function openVideo(){ document.getElementById("videoModal").style.display="flex"; }
    function closeVideo(){ document.getElementById("videoModal").style.display="none"; }
  </script>
</body>
</html>
